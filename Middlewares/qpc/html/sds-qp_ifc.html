<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>QP/C: Interface Viewpoint</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="doxygen-awesome-darkmode-toggle.js"></script>
<script type="text/javascript" src="doxygen-awesome-fragment-copy-button.js"></script>
<script type="text/javascript" src="doxygen-awesome-paragraph-link.js"></script>
<script type="text/javascript">
    DoxygenAwesomeFragmentCopyButton.init()
    DoxygenAwesomeDarkModeToggle.init()
    DoxygenAwesomeParagraphLink.init()
</script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only-darkmode-toggle.css" rel="stylesheet" type="text/css"/>
<link href="spexy-awesome.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
  <div id="projectlogo">
    <a href="https://www.state-machine.com" title="Quantum Leaps"><img alt="Logo" src="logo_ql.webp"/></a>
  </div>
   <div id="projectname">
    QP/C
    &nbsp;<span id="projectnumber">8.0.2</span>
   </div>
   <div id="projectbrief">Real-Time Embedded Framework</div>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.13.2 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;"
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('sds-qp_ifc.html',''); initResizable(true); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Interface Viewpoint</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><span class="prev_button"><a class="el" href="sds-qp_time.html">Time Viewpoint</a></span>  </p><div style="clear:both"></div> <p>The <b>Interface Viewpoint</b> focuses on defining and describing the interfaces between QP Framework and the outside layers, such as the underlying operating system (OS Abstraction Layer) and the QP Application.</p>
<p>The <b>OS Abstraction Layer</b> (OSAL) shown in <a class="el" href="#sds-qp_fig-osal">Figure SDS-OSAL</a>, insulates QP Framework from the underlying Operating System (OS), such as one of the built-in real-time kernels, 3rd-party RTOS, or a General-Purpose OS. The OSAL provides both the abstract <em>Operating System API</em> (OSAL API), see <a class="el" href="#sds-qp_fig-osal">Figure SDS-OSAL [2A]</a>, and the <em>implementation</em> of this API for the specific OS (<a class="el" href="#sds-qp_fig-osal">Figure SDS-OSAL [2B]</a>). The main idea of an OSAL is that the <em>OSAL API</em> is fixed and is used used inside the QP Framework source code, while the OSAL implementation (called the "QP port") depends on the specific underlying OS. In other words, there is a separate "QP port" for every supported real-time kernel, 3rd-party RTOS or GPOS. The main focus of this section is to describe the design of the <em>OSAL API</em>, with the specific examples are taken from various "QP ports" implementing the OSAL API.</p>
<dl class="section remark"><dt>Remarks</dt><dd>The OSAL is an example of the "Facade" design pattern <a class="el" href="sds-qp.html#sds-qp_ref">[GoF:94]</a>.</dd></dl>
<p><a class="anchor" id="sds-qp_fig-osal"></a></p><div class="image">
<object type="image/svg+xml" data="sds-qp_osal.svg" width="1500px" style="pointer-events: none;"></object>
</div>
  <div class="caption"><center><em>Figure SDS-OSAL: QP Port implementing OS Abstraction Layer.</em></center></div><h1><a class="anchor" id="sds-qp_osal-cs"></a>
Critical Section</h1>
<p><b>Critical section</b> is a non-blocking mutual exclusion mechanism that protects a sequence of instructions from preemption. QP Framework, just like any other system-level software, must internally use critical sections to guarantee <em>concurrency-safe</em> operation. The critical section implementation depends on the underlying OS, so the QP OSAL must provide an efficient critical section <em>abstraction</em> to insulate QP Framework from the specifics of teh underlying OS.</p>
<p>For example, in single-core embedded systems, critical sections are typically implemented by disabling interrupts upon the entry to the section and re-enabling them upon the exit. This is effective because in such systems interrupts are the only way preemption can be initiated (both interrupt preemption but also thread preemption in a real-time kernel). However, other systems (e.g., multicore) might use a different critical section mechanism (e.g. spin-lock). Some other systems (e.g., general purpose OS) might implement user-space critical sections with the traditional mutual-exclusion mechanism, such as a mutex. The critical section abstraction in QP OSAL must accommodate all such critical section implementations.</p>
<dl class="section note"><dt>Note</dt><dd>The maximum time spent in a critical section directly affects the system's responsiveness to external events (interrupt latency and task-level response). Therefore, all critical sections inside QP Framework source code are carefully designed to be as short as possible and are of the same order as critical sections in any commercial RTOS. Of course, the length of critical sections depends on the actual critical section mechanism and the quality of the code generated by the compiler.</dd></dl>
<p><a id="a171_SDS_5FQP_5FCRIT" name="a171_SDS_5FQP_5FCRIT"></a> </p>
<h2><a class="anchor" id="SDS_QP_CRIT"></a>
SDS_QP_CRIT</h2>
<table class="doxtable">
<tr>
<td style="text-align:left; width:var(--content-maxwidth)"><p class="starttd"><b>SDS_QP_CRIT</b>: <em>Critical Section API</em></p>
<p class="endtd"></p>
</td></tr>
<tr>
<td><p class="starttd"><b>Description</b><br  />
</p>
<p class="intertd">The critical section abstraction in QP OSAL consists of three parameter-less macros: critical-section status, critical-section-entry and critical-section-exit.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#define QF_CRIT_STAT     ...</span></div>
<div class="line"><span class="preprocessor">#define QF_CRIT_ENTRY()  ...</span></div>
<div class="line"><span class="preprocessor">#define QF_CRIT_EXIT()   ...</span></div>
</div><!-- fragment --><p class="intertd">These macros support two main types of critical section implementations:</p><ol type="1">
<li>Simple critical section entry/exit (empty definition of the macro <code>QF_CRIT_STAT</code>);</li>
<li>Save-and-restore critical section status (not-empty definition of the macro <code>QF_CRIT_STAT</code>).</li>
</ol>
<p class="intertd">Internally, QP Framework uses the critical section macros in the following generic way:</p>
<div class="fragment"><div class="line">    . . . <span class="comment">// outside critical section</span></div>
<div class="line">[1] <a class="code hl_define" href="qp__port_8h.html#af8d7831ad960cc7d985fb3d70c54cac0">QF_CRIT_STAT</a></div>
<div class="line">    . . . <span class="comment">// outside critical section</span></div>
<div class="line">[2] <a class="code hl_define" href="qp__port_8h.html#a825bd2cd3576ca7713b5e30a21ad263d">QF_CRIT_ENTRY</a>();</div>
<div class="line">[3] . . . <span class="comment">// inside critical section</span></div>
<div class="line">[4] <a class="code hl_define" href="qp__port_8h.html#af244388ce617361789cb131c70bc0043">QF_CRIT_EXIT</a>();</div>
<div class="line">    . . . <span class="comment">// outside critical section</span></div>
<div class="ttc" id="aqp__port_8h_html_a825bd2cd3576ca7713b5e30a21ad263d"><div class="ttname"><a href="qp__port_8h.html#a825bd2cd3576ca7713b5e30a21ad263d">QF_CRIT_ENTRY</a></div><div class="ttdeci">#define QF_CRIT_ENTRY()</div><div class="ttdef"><b>Definition</b> <a href="qp__port_8h_source.html#l00064">qp_port.h:64</a></div></div>
<div class="ttc" id="aqp__port_8h_html_af244388ce617361789cb131c70bc0043"><div class="ttname"><a href="qp__port_8h.html#af244388ce617361789cb131c70bc0043">QF_CRIT_EXIT</a></div><div class="ttdeci">#define QF_CRIT_EXIT()</div><div class="ttdef"><b>Definition</b> <a href="qp__port_8h_source.html#l00072">qp_port.h:72</a></div></div>
<div class="ttc" id="aqp__port_8h_html_af8d7831ad960cc7d985fb3d70c54cac0"><div class="ttname"><a href="qp__port_8h.html#af8d7831ad960cc7d985fb3d70c54cac0">QF_CRIT_STAT</a></div><div class="ttdeci">#define QF_CRIT_STAT</div><div class="ttdef"><b>Definition</b> <a href="qp__port_8h_source.html#l00055">qp_port.h:55</a></div></div>
</div><!-- fragment --><p class="intertd"><code>[1]</code> If the macro <code>QF_CRIT_STAT</code> is not-empty, it allocates a local critical-section-status variable. Otherwise, if the macro is empty, the line does nothing.</p>
<p class="intertd"><code>[2]</code> the macro <code><a class="el" href="qp__port_8h.html#a825bd2cd3576ca7713b5e30a21ad263d">QF_CRIT_ENTRY()</a></code> enters critical section, which saves the critical section status into the status-variable (if it was defined at step <code>[1]</code>)</p>
<p class="intertd"><code>[3]</code> this code executes inside the critical section protection</p>
<p class="intertd"><code>[4]</code> the macro <code><a class="el" href="qp__port_8h.html#af244388ce617361789cb131c70bc0043">QF_CRIT_EXIT()</a></code> exits critical section, which restores the critical section status from the status variable (if it was defined at step <code>[1]</code>)</p>
<p class="endtd"></p>
</td></tr>
<tr>
<td><p class="starttd"><b>Examples</b><br  />
</p>
<p class="intertd">Example simple critical section macros without critical section status (ARM Cortex-M CPU): </p><div class="fragment"><div class="line"><span class="preprocessor">#define QF_CRIT_STAT     </span><span class="comment">// empty</span></div>
<div class="line"><span class="preprocessor">#define QF_CRIT_ENTRY()  (asm volatile (&quot;cpsid i&quot;))</span></div>
<div class="line"><span class="preprocessor">#define QF_CRIT_EXIT()   (asm volatile (&quot;cpsie i&quot;))</span></div>
</div><!-- fragment --><p class="intertd">Example save-and-restore critical section status macros (MSP430 CPU): </p><div class="fragment"><div class="line"><span class="preprocessor">#define QF_CRIT_STAT     unsigned short int_state_;</span></div>
<div class="line"><span class="preprocessor">#define QF_CRIT_ENTRY()  do {              \</span></div>
<div class="line"><span class="preprocessor">    int_state_ =  __get_interrupt_state(); \</span></div>
<div class="line"><span class="preprocessor">    __disable_interrupt();                 \</span></div>
<div class="line"><span class="preprocessor">} while (false)</span></div>
<div class="line"><span class="preprocessor">#define QF_CRIT_EXIT()   __set_interrupt_state(int_state_)</span></div>
</div><!-- fragment --><p class="endtd"></p>
</td></tr>
<tr>
<td><p class="starttd"><b>Nesting Critical Sections</b><br  />
</p>
<p class="endtd">Some CPUs or operating systems require nesting of one critical section in another critical section. The "save-and-restore critical section status" method enables such critical section nesting in an explicit manner. But even the "simple critical section" method can be implemented in way that allows critical section nesting. For example, the critical section can use an internal up-down nesting counter, which will guarantee that only the last nesting level truly exits the critical section. </p>
</td></tr>
<tr>
<td><p class="starttd"><b>Forward Traceability (truncated to 2 level(s))</b><br  />
</p>
<p class="endtd"></p>
</td></tr>
</table>
<h1><a class="anchor" id="sds-qp_osal-ao"></a>
Active Object OSAL</h1>
<p>TBD...</p>
<p><span class="prev_button"><a class="el" href="sds-qp_time.html">Time Viewpoint</a></span>    </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.9.2-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="sds-qp.html">Software Design Specification</a></li>
    <li class="footer">
<a title="Quantum Leaps: Modern Embedded Software" href="https://www.state-machine.com">&copy; 2005-2025 Quantum Leaps</a> &nbsp;|&nbsp; <a title="help" href="help.html">Using Online Help</a> &nbsp;|&nbsp; <b>QP/C 8.0.2</b> &nbsp;|&nbsp; created with <a title="Spexygen: traceable specifications" href="https://github.com/QuantumLeaps/spexygen"><em>Spexygen</em></a>
<hr class="footer"/><address class="footer"><small>
<a title="Quantum Leaps: Modern Embedded Software" href="https://www.state-machine.com">&copy; 2005-2025 Quantum Leaps</a> &nbsp;|&nbsp; <a title="help" href="help.html">Using Online Help</a> &nbsp;|&nbsp; <b>QP/C 8.0.2</b> &nbsp;|&nbsp; created with <a title="Spexygen: traceable specifications" href="https://github.com/QuantumLeaps/spexygen"><em>Spexygen</em></a>
</small></address>
    </li>
  </ul>
</div>
</body>
</html>
