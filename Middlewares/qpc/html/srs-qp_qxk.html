<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>QP/C: Preemptive Dual-Mode Kernel</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="doxygen-awesome-darkmode-toggle.js"></script>
<script type="text/javascript" src="doxygen-awesome-fragment-copy-button.js"></script>
<script type="text/javascript" src="doxygen-awesome-paragraph-link.js"></script>
<script type="text/javascript">
    DoxygenAwesomeFragmentCopyButton.init()
    DoxygenAwesomeDarkModeToggle.init()
    DoxygenAwesomeParagraphLink.init()
</script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only-darkmode-toggle.css" rel="stylesheet" type="text/css"/>
<link href="spexy-awesome.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
  <div id="projectlogo">
    <a href="https://www.state-machine.com" title="Quantum Leaps"><img alt="Logo" src="logo_ql.webp"/></a>
  </div>
   <div id="projectname">
    QP/C
    &nbsp;<span id="projectnumber">8.0.2</span>
   </div>
   <div id="projectbrief">Real-Time Embedded Framework</div>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.13.2 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;"
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('srs-qp_qxk.html',''); initResizable(true); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Preemptive Dual-Mode Kernel</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><span class="prev_button"><a class="el" href="srs-qp_qk.html">Preemptive Non-Blocking Kernel</a></span><span class="next_button"><a class="el" href="srs-qp_nf.html">Non-Functional Requirements</a></span> </p><div style="clear:both"></div> <h1><a class="anchor" id="srs-qp_qxk-intro"></a>
Concepts &amp; Definitions</h1>
<p>The <a class="el" href="srs-qp_ao.html#srs-qp_ao-model">Active Object model of computation</a> can work with a wide range of real-time kernels. Among others, event-driven Active Objects can be executed by a traditional, blocking RTOS kernel, where each Active Object runs in its own RTOS thread structured as an <em>event-loop</em>. However, using a traditional, blocking RTOS to execute non-blocking Active Objects is wasteful. As demonstrated in the <a class="el" href="srs-qp_qk.html">QK Preemptive Non-Blocking Kernel</a>, non-blocking Active Objects can be executed more efficiently as one-shot, run-to-completion steps.</p>
<h2><a class="anchor" id="srs-qp_qxk-def"></a>
QXK Dual-Mode Kernel</h2>
<p>QXK is a preemptive, fixed-priority, dual-mode (blocking / non-blocking) kernel that executes Active Objects like the <a class="el" href="srs-qp_qk.html">QK kernel</a> (<a class="el" href="#srs-qp_qxk-basic">basic tasks</a>), but can also execute traditional <b>blocking</b> threads (<a class="el" href="#srs-qp_qxk-ext">extended tasks</a>). In this respect, QXK behaves like a traditional RTOS.</p>
<dl class="section remark"><dt>Remarks</dt><dd>QXK adopts the "basic/extended tasks" terms from the <a href="https://www.autosar.org" target="_blank" rel="noopener">OSEK/AUTOSAR Operating System&uarr;</a> specification <a class="el" href="srs-qp.html#srs-qp_ref">[OSEK:03]</a>. Other real-time kernels might use different terminology for similar concepts.</dd></dl>
<p>QXK has been designed specifically for combining event-driven Active Objects with traditional code that requires <b>blocking</b>, such as commercial middleware (TCP/IP stacks, UDP stacks, embedded file systems, etc.) or legacy software. To this end, QXK is not only more efficient than running QP on top of a <a class="el" href="ports_rtos.html">traditional 3rd-party RTOS</a> (because non-blocking <a class="el" href="#srs-qp_qxk-basic">basic tasks</a> take less stack space and CPU cycles for context switch than the much heavier <a class="el" href="#srs-qp_qxk-ext">extended tasks</a>). But the biggest advantage of QXK is that it <em>protects</em> the application-level code from inadvertent mixing of blocking calls inside the event-driven Active Objects. Specifically, QXK "knows" the type of the task context (extended/basic) and asserts internally if a blocking call (e.g., semaphore-wait or a time-delay) is attempted in a basic task (Active Object).</p>
<p><a class="anchor" id="srs-qp_qxk-unsafe"></a></p><dl class="section note"><dt>Note</dt><dd>The QXK dual-mode kernel is significantly more complex than the <a class="el" href="srs-qp_qv.html">QV non-preemptive kernel</a> and the <a class="el" href="srs-qp_qk.html">QK preemptive non-blocking kernel</a>, and therefore it is <b>not recommended</b> for safety-critical applications.</dd></dl>
<h2><a class="anchor" id="srs-qp_qxk-basic"></a>
Basic Tasks</h2>
<p><b>Basic</b> tasks are one-shot, non-blocking, run-to-completion activations. The basic-task can nest on the same stack. Also, context switching from a basic-task to another basic-task requires only activation of the basic-task, which is simpler and faster than full context-switch required for <a class="el" href="#srs-qp_qxk-ext">extended</a>-tasks (that QXK also supports, see below).</p>
<h2><a class="anchor" id="srs-qp_qxk-ext"></a>
Extended tasks</h2>
<p><b>Extended</b> tasks are endless loops allowed to block. Extended tasks require private per-task stacks, as in conventional RTOS kernels. Any switching from basic-to-extended task or extended-to-extended task requires full context switch.</p>
<dl class="section remark"><dt>Remarks</dt><dd>QXK is a unique dual-mode kernel on the market that supports interleaving the priorities of basic tasks and extended tasks. Other dual-mode kernels typically limit the priorities of basic tasks to be always higher (more urgent) than any of the extended tasks.</dd></dl>
<h2><a class="anchor" id="srs-qp_qxk-block"></a>
QXK Blocking Mechanisms</h2>
<p>QXK provides most blocking mechanisms found in traditional blocking RTOS kernels:</p><ul>
<li><b>Counting Semaphores</b> with optional timeout that can block multiple extended-tasks;</li>
<li><b>Binary Semaphores</b> (as a subset of counting semaphores);</li>
<li><b>Blocking Event Queue</b> with optional timeout bound to each extended-task;</li>
<li>Priority-Ceiling, recursive <b>Mutexes</b> with optional timeout;</li>
</ul>
<h2><a class="anchor" id="srs-qp_qxk-lock"></a>
Selective Scheduler Locking</h2>
<p>As all <em>preemptive</em> kernels, QXK requires the QP Application to be very careful with any resource sharing among Active Objects. Ideally, the Active Objects should communicate exclusively via events and otherwise should <a class="el" href="srs-qp_ao.html#srs-qp_ao-sharing">not share</a> any resources. However, at the cost of increased coupling among Active Objects, QP Application might choose to share selected resources. However, such QP Application takes the burden on itself to apply a <b>mutual exclusion mechanism</b> while accessing any shared resources.</p>
<p>QXK kernel provides <b>selective scheduler locking</b> as a powerful mutual exclusion mechanism. Specifically, before accessing a shared resource, an Active Objects can <b>lock</b> the QXK scheduler up to the specified <em>priority ceiling</em>. This prevents Active Object preemption up to the specified <em>priority ceiling</em>, while not affecting Active Objects (or interrupts) of priority higher than the <em>priority ceiling</em>. After accessing the shared resource the Active Object must <b>unlock</b> the QXK scheduler.</p>
<p>Selective scheduling locking is a <em>non-blocking</em> mechanism. If an Active Object that needs to protect a shared resource is running, it means that all Active Objects of higher priority have no events to process. Consequently, simply preventing activation of higher-priority AOs that might access the resource is sufficient to guarantee the mutually exclusive access to the resource. Of course, you don't need to worry about any lower-priority AOs that might be preempted because they never resume until the current AO runs to completion.</p>
<p>Selective scheduler lock requests made by the same Active Object <em>can nest</em>. The nested lock requests can only increase the priority ceiling. Also, the nested lock requests must unlock the scheduler by <em>restoring</em> the previous priority ceiling.</p>
<h2><a class="anchor" id="srs-qp_qxk-rt"></a>
Task-Level Response</h2>
<p>As a fully <em>preemptive</em>, fixed-priority kernel, QXK always executes the highest-priority task that is ready to run (is not blocked). The scheduling algorithm used in QXK meets all the requirement of the Rate Monotonic Scheduling (a.k.a. Rate Monotonic Analysis RMA) and can be used in hard real-time systems.</p>
<h1><a class="anchor" id="srs-qp_qxk-req"></a>
Requirements</h1>
<dl class="section note"><dt>Note</dt><dd>As <a class="el" href="#srs-qp_qxk-unsafe">stated above</a>, due to its complexity the QXK dual-mode kernel is <b>not recommended</b> for safety-critical applications. Therefore, this section contains only high-level requirements for the QXK kernel without the details needed to verify and validate QXK for functional safety.</dd></dl>
<p><a id="a92_SRS_5FQP_5FQXK_5F00" name="a92_SRS_5FQP_5FQXK_5F00"></a> </p>
<h2><a class="anchor" id="SRS_QP_QXK_00"></a>
SRS_QP_QXK_00</h2>
<table class="doxtable">
<tr>
<td style="text-align:left; width:var(--content-maxwidth)"><p class="starttd"><b>SRS_QP_QXK_00</b>: <em>QP Framework shall provide preemptive non-blocking QXK kernel as one of the built-in kernels.</em></p>
<p class="endtd"></p>
</td></tr>
<tr>
<td><p class="starttd"><b>Description</b><br  />
</p>
<p class="endtd">QP Framework shall provide QXK kernel implementation and ports to the supported CPU/compiler combinations as one of the optional software components. QP Application can then choose the QXK kernel to execute Active Objects and extended tasks. Such a selection is exclusive, meaning that when QP Application selects the QXK kernel, other kernels are excluded and cannot be used. </p>
</td></tr>
<tr>
<td><p class="starttd"><b>Description</b><br  />
</p>
<p class="endtd">QP Framework can implement the QXK kernel component by re-using already existing mechanisms, such as event queues for Active Objects, event delivery mechanisms, event memory management, etc. </p>
</td></tr>
<tr>
<td><p class="starttd"><b>Forward Traceability (truncated to 2 level(s))</b><br  />
</p>
<p class="endtd"></p>
</td></tr>
</table>
<p><a id="a93_SRS_5FQP_5FQXK_5F10" name="a93_SRS_5FQP_5FQXK_5F10"></a> </p>
<h2><a class="anchor" id="SRS_QP_QXK_10"></a>
SRS_QP_QXK_10</h2>
<table class="doxtable">
<tr>
<td style="text-align:left; width:var(--content-maxwidth)"><p class="starttd"><b>SRS_QP_QXK_10</b>: <em>QXK kernel shall support <u>basic</u> tasks for execution of Active Objects and shall handle them like the QK kernel.</em></p>
<p class="endtd"></p>
</td></tr>
<tr>
<td><p class="starttd"><b>Description</b><br  />
</p>
<p class="endtd">QXK kernel shall provide API for designating an Active Object, which will require a unique priority and event queue, but not a private stack. Subsequently, QXK kernel shall execute thus designated Active Object as a basic-task by dispatching events to its state machine. </p>
</td></tr>
<tr>
<td><p class="starttd"><b>Forward Traceability (truncated to 2 level(s))</b><br  />
</p>
<p class="endtd"></p>
</td></tr>
</table>
<p><a id="a94_SRS_5FQP_5FQXK_5F11" name="a94_SRS_5FQP_5FQXK_5F11"></a> </p>
<h2><a class="anchor" id="SRS_QP_QXK_11"></a>
SRS_QP_QXK_11</h2>
<table class="doxtable">
<tr>
<td style="text-align:left; width:var(--content-maxwidth)"><p class="starttd"><b>SRS_QP_QXK_11</b>: <em>QXK kernel shall support <u>extended</u> tasks for execution of blocking threads and shall execute them like a conventional RTOS kernel.</em></p>
<p class="endtd"></p>
</td></tr>
<tr>
<td><p class="starttd"><b>Description</b><br  />
</p>
<p class="endtd">QXK kernel shall provide API for designating an extended task (distinct from designating an Active Object), which will require a unique priority, optional event queue, and a private stack. Subsequently, QXK kernel shall execute thus designated object as an extended task. If an extended task is configured with an event queue, such an extened task can <em>block</em> on that queue and receive events through that queue. </p>
</td></tr>
<tr>
<td><p class="starttd"><b>Forward Traceability (truncated to 2 level(s))</b><br  />
</p>
<p class="endtd"></p>
</td></tr>
</table>
<p><a id="a95_SRS_5FQP_5FQXK_5F12" name="a95_SRS_5FQP_5FQXK_5F12"></a> </p>
<h2><a class="anchor" id="SRS_QP_QXK_12"></a>
SRS_QP_QXK_12</h2>
<table class="doxtable">
<tr>
<td style="text-align:left; width:var(--content-maxwidth)"><p class="starttd"><b>SRS_QP_QXK_12</b>: <em>QXK kernel shall support mixing basic and extended tasks.</em></p>
<p class="endtd"></p>
</td></tr>
<tr>
<td><p class="starttd"><b>Description</b><br  />
</p>
<p class="endtd">QXK shall allow combining basic tasks (Active Objects) and extended tasks (threads) in a single application. QXK shall allow interleaving the unique priorities of basic tasks and extended tasks and prioritize them according to the same uniform prioritization scheme described in <a class="el" href="srs-qp_ao.html#SRS_QP_AO_10">SRS_QP_AO_10</a>. </p>
</td></tr>
<tr>
<td><p class="starttd"><b>Forward Traceability (truncated to 2 level(s))</b><br  />
</p>
<p class="endtd"></p>
</td></tr>
</table>
<p><a id="a96_SRS_5FQP_5FQXK_5F13" name="a96_SRS_5FQP_5FQXK_5F13"></a> </p>
<h2><a class="anchor" id="SRS_QP_QXK_13"></a>
SRS_QP_QXK_13</h2>
<table class="doxtable">
<tr>
<td style="text-align:left; width:var(--content-maxwidth)"><p class="starttd"><b>SRS_QP_QXK_13</b>: <em>QXK kernel shall support interactions between basic and extended tasks.</em></p>
<p class="endtd"></p>
</td></tr>
<tr>
<td><p class="starttd"><b>Description</b><br  />
</p>
<p class="endtd">QXK shall support the following integrated mechanisms for communication between extended and basic tasks:</p><ul>
<li>Extended tasks can post or publish events to Active Objects;</li>
<li>Extended tasks can post or publish events to other extended tasks (that provide an event queue);</li>
<li>Extended tasks that provide an event queue can subscribe to events and thus can participate in the publish/subscribe event delivery;</li>
<li>Basic tasks (Active Objects) can signal semaphores and post events to extended tasks (those that provide an event queue). </li>
</ul>
</td></tr>
<tr>
<td><p class="starttd"><b>Forward Traceability (truncated to 2 level(s))</b><br  />
</p>
<p class="endtd"></p>
</td></tr>
</table>
<p><a id="a97_SRS_5FQP_5FQXK_5F20" name="a97_SRS_5FQP_5FQXK_5F20"></a> </p>
<h2><a class="anchor" id="SRS_QP_QXK_20"></a>
SRS_QP_QXK_20</h2>
<table class="doxtable">
<tr>
<td style="text-align:left; width:var(--content-maxwidth)"><p class="starttd"><b>SRS_QP_QXK_20</b>: <em>QXK kernel shall support counting <u>semaphores</u> with optional timeout.</em></p>
<p class="endtd"></p>
</td></tr>
<tr>
<td><p class="starttd"><b>Description</b><br  />
</p>
<p class="endtd">QXK shall support counting semaphores as on of the standard blocking mechanisms. As a special case, counting semaphore with maximum 1 shall behave as a binary semaphore. The blocking semaphore-wait operation (with optional timeout) shall be allowed only inside the extended threads. However, signaling a semaphore is allowed both from Active Objects and ISRs. </p>
</td></tr>
<tr>
<td><p class="starttd"><b>Forward Traceability (truncated to 2 level(s))</b><br  />
</p>
<p class="endtd"></p>
</td></tr>
</table>
<p><a id="a98_SRS_5FQP_5FQXK_5F21" name="a98_SRS_5FQP_5FQXK_5F21"></a> </p>
<h2><a class="anchor" id="SRS_QP_QXK_21"></a>
SRS_QP_QXK_21</h2>
<table class="doxtable">
<tr>
<td style="text-align:left; width:var(--content-maxwidth)"><p class="starttd"><b>SRS_QP_QXK_21</b>: <em>QXK kernel shall support blocking <u>event queues</u> with optional timeout.</em></p>
<p class="endtd"></p>
</td></tr>
<tr>
<td><p class="starttd"><b>Description</b><br  />
</p>
<p class="endtd">For extended tasks configured with an event queue, QXK shall support blocking on that event queue (with optional timeout) inside the endless loop of the extended task. </p>
</td></tr>
<tr>
<td><p class="starttd"><b>Forward Traceability (truncated to 2 level(s))</b><br  />
</p>
<p class="endtd"></p>
</td></tr>
</table>
<p><a id="a99_SRS_5FQP_5FQXK_5F22" name="a99_SRS_5FQP_5FQXK_5F22"></a> </p>
<h2><a class="anchor" id="SRS_QP_QXK_22"></a>
SRS_QP_QXK_22</h2>
<table class="doxtable">
<tr>
<td style="text-align:left; width:var(--content-maxwidth)"><p class="starttd"><b>SRS_QP_QXK_22</b>: <em>QXK kernel shall support blocking recursive <u>mutexes</u> with optional timeout.</em></p>
<p class="endtd"></p>
</td></tr>
<tr>
<td><p class="starttd"><b>Description</b><br  />
</p>
<p class="endtd">QXK shall support mutexes as on of the standard mutual exclusion mechanisms. The blocking mutex-lock operation (with optional timeout) shall be allowed only inside the extended threads. The mutex shall support the priority-ceiling protocol to prevent unbounded priority inversion. The mutex shall also allow recursive locking (by the same extended task). </p>
</td></tr>
<tr>
<td><p class="starttd"><b>Forward Traceability (truncated to 2 level(s))</b><br  />
</p>
<p class="endtd"></p>
</td></tr>
</table>
<p><span class="prev_button"><a class="el" href="srs-qp_qk.html">Preemptive Non-Blocking Kernel</a></span><span class="next_button"><a class="el" href="srs-qp_nf.html">Non-Functional Requirements</a></span>   </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.9.2-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="srs-qp.html">Software Requirements Specification</a></li>
    <li class="footer">
<a title="Quantum Leaps: Modern Embedded Software" href="https://www.state-machine.com">&copy; 2005-2025 Quantum Leaps</a> &nbsp;|&nbsp; <a title="help" href="help.html">Using Online Help</a> &nbsp;|&nbsp; <b>QP/C 8.0.2</b> &nbsp;|&nbsp; created with <a title="Spexygen: traceable specifications" href="https://github.com/QuantumLeaps/spexygen"><em>Spexygen</em></a>
<hr class="footer"/><address class="footer"><small>
<a title="Quantum Leaps: Modern Embedded Software" href="https://www.state-machine.com">&copy; 2005-2025 Quantum Leaps</a> &nbsp;|&nbsp; <a title="help" href="help.html">Using Online Help</a> &nbsp;|&nbsp; <b>QP/C 8.0.2</b> &nbsp;|&nbsp; created with <a title="Spexygen: traceable specifications" href="https://github.com/QuantumLeaps/spexygen"><em>Spexygen</em></a>
</small></address>
    </li>
  </ul>
</div>
</body>
</html>
